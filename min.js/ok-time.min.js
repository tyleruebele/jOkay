/* Copyright (c) 2013 Tyler Uebele * Released under the MIT license. * latest at https://github.com/tyleruebele/jOkay * minified at jscompress.com */
function okTime(e){e=e.replace(/^\s+|\s+$/g,"");var t;var n=new Date;if(""==e){okTime.errno=4;return false}if(/^now/i.exec(e)){return n}if(/^(12(00)?n|noon?|midd(ay?)?)/i.exec(e)){n.setSeconds(0);n.setMinutes(0);n.setHours(12);return n}if((new RegExp("^"+e,"i")).test("midnight")){n.setSeconds(0);n.setMinutes(0);n.setHours(0);return n}var r;var i;var s;if(t=/^(\d{1,2})(\d{2})?(\d{2})?\s*(am?|pm?)?$/i.exec(e)){r=parseInt(t[1],10);if(r>23){okTime.errno=1;return false}i=parseInt(t[2],10);if(i>59){okTime.errno=2;return false}s=parseInt(t[3],10);if(s>59){okTime.errno=3;return false}if(t[4]){r+=t[4].toLowerCase().indexOf("p")>-1?12:0;if(r==12){r=0}}n.setSeconds(s||0);n.setMinutes(i||0);n.setHours(r);return n}if(t=/^(\d{1,2}):(\d{1,2})(:(\d{1,2}))?\s*(am?|pm?)?$/i.exec(e)){r=parseInt(t[1],10);if(r>23){okTime.errno=1;return false}i=parseInt(t[2],10);if(i>59){okTime.errno=2;return false}s=parseInt(t[4],10);if(s>59){okTime.errno=3;return false}if(t[5]){r+=t[5].toLowerCase().indexOf("p")>-1?12:0;if(r==12){r=0}}n.setSeconds(s||0);n.setMinutes(i||0);n.setHours(r);return n}var o;if(o=Date.parse(e)){n.setSeconds(0);n.setMinutes(0);n.setHours(0);n.setDate(1);n.setFullYear(1970);n.setMonth(0);n.setMilliseconds(o);return n}okTime.errno=okTime.errors.length;return false}okTime.blur=function(e,t,n){if("undefined"===typeof n){n=!!t.className.match(/js-ok-time-24/)}if(""==t.value.replace(/^\s+|\s+$/g,"")){return}t.className=t.className.replace(okTime.errorClass,"");var r=okTime(t.value);if(false===r){t.title=okTime.errors[okTime.errno];t.className+=" "+okTime.errorClass}else{t.title="";t.value=okTime.format(r,n)}};okTime.key=function(e,t,n){if("undefined"===typeof n){n=!!t.className.match(/js-ok-time-24/)}var r=e.keyCode?e.keyCode:e.which;var i;switch(r){case 38:i=okTime(t.value||"now");if(false===i){break}if(e.shiftKey){i.setHours(i.getHours()+1)}else{i.setMinutes(i.getMinutes()+1)}t.value=okTime.format(i,n);t.className=t.className.replace(okTime.errorClass,"");break;case 40:i=okTime(t.value||"now");if(false===i){break}if(e.shiftKey){i.setHours(i.getHours()-1)}else{i.setMinutes(i.getMinutes()-1)}t.value=okTime.format(i,n);t.className=t.className.replace(okTime.errorClass,"");break;case 39:if(""==t.value){t.value=okTime.format(new Date,n)}break}return true};okTime.init=function(){var e=document.querySelectorAll(okTime.query);for(var t=e.length-1;t>=0;t--){if("text"==e[t].type){if(window.addEventListener){e[t].addEventListener("blur",function(e){okTime.blur(e,this)});e[t].addEventListener("keyup",function(e){okTime.key(e,this)})}else if(window.attachEvent){e[t].attachEvent("onblur",function(e){e=e||window.event;okTime.blur(e,e.target||e.srcElement)});e[t].attachEvent("onkeyup",function(e){e=e||window.event;okTime.key(e,e.target||e.srcElement)})}}}};okTime.format=function(e,t){var n=e.getHours();var r=String(e.getMinutes());var i=String(e.getSeconds());var s="";if(!t){s=n>11?"pm":"am";n%=12;if(n==0){n=12}n=String(n)}else{n=String(n);n=1===n.length?"0"+n:n}r=1===r.length?"0"+r:r;i=1===i.length?"0"+i:i;return n+":"+r+":"+i+s};okTime.errno=0;okTime.errors=["Time Validation Passed","Invalid Hour","Invalid Minute","Invalid Second","Empty String","Time Validation Failed"];okTime.query="input[type=time],"+"input.js-ok-time,"+"input.js-ok-time-12,"+"input.js-ok-time-24";okTime.errorClass="js-ok-time-error";window.addEventListener?window.addEventListener("load",okTime.init,false):window.attachEvent&&window.attachEvent("onload",okTime.init)
