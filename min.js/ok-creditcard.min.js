/* Copyright (c) 2006-2013 Tyler Uebele * Released under the MIT license. * latest at https://github.com/tyleruebele/jOkay * minified by Google Closure Compiler */
function okCreditCard(b,a){b=b.replace(/[\s\-]/g,"");a="undefined"!==typeof a?a:okCreditCard.infer(b);if(!/^\d*$/.exec(b))return okCreditCard.errno=1,!1;if(!okCreditCard.Types[a])return alert(a),okCreditCard.errno=2,!1;if(!RegExp("^"+okCreditCard.Types[a].prefixes).test(b))return okCreditCard.errno=3,!1;if(!RegExp("^"+okCreditCard.Types[a].len).test(b.length))return okCreditCard.errno=4,!1;if(!okCreditCard.checkDigit(b,a))return okCreditCard.errno=5,!1;okCreditCard.errno=0;return b}
okCreditCard.blur=function(b,a){a.className=a.className.replace(okCreditCard.errorClass,"");a.title="";if(""!=a.value.replace(/^\s+|\s+$/g,"")){var c=okCreditCard(a.value);!1===c?(a.title=okCreditCard.errors[okCreditCard.errno],a.className+=" "+okCreditCard.errorClass):(a.title="",a.value=c)}};
okCreditCard.init=function(){for(var b=document.querySelectorAll(okCreditCard.query),a=b.length-1;0<=a;a--)"text"==b[a].type&&(window.addEventListener?b[a].addEventListener("blur",function(a){okCreditCard.blur(a,this)}):window.attachEvent&&b[a].attachEvent("onblur",function(a){a=a||window.event;okCreditCard.blur(a,a.target||a.srcElement)}))};okCreditCard.errno=0;okCreditCard.errors="Credit Card Validation Passed;Invalid Credit Card #;Unsupported Card Type;Credit Card # does not match specified type;Invalid Number Length;Invalid Credit Card Checksum;Credit Card Validation Failed".split(";");
okCreditCard.query="input[type=creditcard],input.js-ok-creditcard";okCreditCard.errorClass="js-ok-creditcard-error";okCreditCard.checkDigit=function(b,a){if(okCreditCard.Types[a].hasCheckDigit){var c=0,d,e,f;d=b.length-1;for(e=!0;0<=d;d--,e=!e)c=e?c+parseInt(b.charAt(d)):4<(f=parseInt(b.charAt(d)))?c+(2*f-9):c+2*f;if(0!=c%10)return!1}return!0};
okCreditCard.Types={Visa:{hasCheckDigit:!0,len:"13|16",prefixes:"4"},MasterCard:{hasCheckDigit:!0,len:"16",prefixes:"51|52|53|54|55"},AmEx:{hasCheckDigit:!0,len:"15",prefixes:"34|37"},Discover:{hasCheckDigit:!0,len:"16",prefixes:"6011|650"},DinersClub:{hasCheckDigit:!0,len:"14|16",prefixes:"300|301|302|303|304|305|36|38|55"},CarteBlanche:{hasCheckDigit:!0,len:"14",prefixes:"300|301|302|303|304|305|36|38"},JCB:{hasCheckDigit:!0,len:"15|16",prefixes:"3|1800|2131"},enRoute:{hasCheckDigit:!0,len:"15",
prefixes:"2014|2149"},Solo:{hasCheckDigit:!0,len:"16|18|19",prefixes:"6334|6767"},Switch:{hasCheckDigit:!0,len:"16|18|19",prefixes:"4903|4905|4911|4936|564182|633110|6333|6759"},Maestro:{hasCheckDigit:!0,len:"16",prefixes:"5020|6"},VisaElectron:{hasCheckDigit:!0,len:"16",prefixes:"417500|4917|4913"}};
okCreditCard.infer=function(b){b=b.replace(/[\s\-]/g,"");if(!/^\d*$/.exec(b))return okCreditCard.errno=1,!1;var a={},c;for(c in okCreditCard.Types)RegExp("^("+okCreditCard.Types[c].prefixes+")").test(b)&&(a[c]=!0);if(0==a.length)return!1;for(c in a)RegExp("^("+okCreditCard.Types[c].len+")$").test(b.length)||delete a.type;if(0==a.length)return!1;for(c in a)return c};window.addEventListener?window.addEventListener("load",okCreditCard.init,!1):window.attachEvent&&window.attachEvent("onload",okCreditCard.init);
