function okDate(c,d){c=c.replace(/^\s+|\s+$/g,"");d="undefined"!==typeof d?d:"mdy";okDate.errno=0;var a=new Date;if(/^now/i.exec(c)||/^tod(ay?)?$/i.exec(c))return a;if(RegExp("^"+c,"i").test("tomorrow"))return a.setDate(a.getDate()+1),a;if(RegExp("^"+c,"i").test("yesterday"))return a.setDate(a.getDate()-1),a;var b,e;if(b=/^(\d{1,2})(?:st|nd|rd|th)?$/i.exec(c))return e=a.getMonth(),a.setDate(parseInt(b[1],10)),e!=a.getMonth()?(okDate.errno=1,!1):a;if(b=/^(\d{1,2})(?:st|nd|rd|th)? (\w+)$/i.exec(c))return a.setDate(1),
a.setMonth(e=okDate.month(b[2])),a.setDate(parseInt(b[1],10)),!1===e?(okDate.errno=3,!1):e!=a.getMonth()?(okDate.errno=2,!1):a;if(b=/^(\d{1,2})(?:st|nd|rd|th)? (\w+),? (\d{2,4})$/i.exec(c))return a.setDate(1),a.setFullYear(okDate.year(parseInt(b[3],10))),a.setMonth(e=okDate.month(b[2])),a.setDate(parseInt(b[1],10)),!1===e?(okDate.errno=3,!1):e!=a.getMonth()?(okDate.errno=2,!1):a;if(b=/^(\w+) (\d{1,2})(?:st|nd|rd|th)?$/i.exec(c))return a.setDate(1),a.setMonth(e=okDate.month(b[1])),a.setDate(parseInt(b[2],
10)),!1===e?(okDate.errno=3,!1):e!=a.getMonth()?(okDate.errno=2,!1):a;if(b=/^(\w+) (\d{1,2})(?:st|nd|rd|th)?,? (\d{2,4})$/i.exec(c))return a.setDate(1),a.setFullYear(okDate.year(parseInt(b[3],10))),a.setMonth(e=okDate.month(b[1])),a.setDate(parseInt(b[2],10)),!1===e?(okDate.errno=3,!1):e!=a.getMonth()?(okDate.errno=2,!1):a;var f;if(b=/^(\w+)$/i.exec(c)){e=a.getDay();b=okDate.weekday(b[1]);if(!1===b)return okDate.errno=4,!1;f=b-e;a.setDate(a.getDate()+f);return a}if(b=/^(\w+) week$/i.exec(c)){e=a.getDay();
b=okDate.weekday(b[1]);if(!1===b)return okDate.errno=4,!1;f=b-e;b<=e&&(f+=7);f+=7;a.setDate(a.getDate()+f);return a}if(b=/^next? (\w+)$/i.exec(c)){e=a.getDay();b=okDate.weekday(b[1]);if(!1===b)return okDate.errno=4,!1;f=b-e;b<=e&&(f+=7);a.setDate(a.getDate()+f);return a}if(b=/^last? (\w+)$/i.exec(c)){e=a.getDay();b=okDate.weekday(b[1]);if(!1===b)return okDate.errno=4,!1;f=b-e;b>=e&&(f-=7);a.setDate(a.getDate()+f);return a}if(b=/^(\d{1,2})[\/.-](\d{1,2})(?:[\/.-](\d{2,4}))?$/.exec(c))return"dmy"!=
d&&(e=b[1],b[1]=b[2],b[2]=e),a.setDate(1),b[3]&&a.setFullYear(okDate.year(parseInt(b[3],10))),a.setMonth(e=parseInt(b[2],10)-1),a.setDate(parseInt(b[1],10)),12<=e?(okDate.errno=3,!1):e!=a.getMonth()?(okDate.errno=2,!1):a;if(b=/^(\d{4})-(\d{1,2})-(\d{1,2})$/.exec(c))return a.setDate(1),a.setFullYear(parseInt(b[1],10)),a.setMonth(e=parseInt(b[2],10)-1),a.setDate(parseInt(b[3],10)),12<=e?(okDate.errno=3,!1):e!=a.getMonth()?(okDate.errno=2,!1):a;if(b=Date.parse(c))return a.setTime(b),a;okDate.errno=okDate.errors.length-
1;return!1}okDate.year=function(c){return 70>c?c+2E3:100>c?c+1900:1E3>c?c+1E3:c};okDate.months="January February March April May June July August September October November December".split(" ");okDate.month=function(c){var d=okDate.months.filter(function(a){return RegExp("^"+c,"i").test(a)});return 1!=d.length?!1:okDate.months.indexOf(d[0])};okDate.weekdays="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");
okDate.weekday=function(c){var d=okDate.weekdays.filter(function(a){return RegExp("^"+c,"i").test(a)});return 1!=d.length?!1:okDate.weekdays.indexOf(d[0])};okDate.errno=0;okDate.errors="Date Validation Passed;Too many days for current month;Too many days for specified month;Invalid month specified;Invalid weekday specified;Date Validation Failed".split(";");okDate.query="input[type=date],input.js-ok-date,input.js-ok-date-ymd,input.js-ok-date-mdy,input.js-ok-date-dmy";okDate.errorClass="js-ok-date-error";
okDate.init=function(){for(var c=document.querySelectorAll(okDate.query),d=c.length-1;0<=d;d--)"text"==c[d].type&&(window.addEventListener?(c[d].addEventListener("blur",function(a){okDate.blur(a,this)}),c[d].addEventListener("keyup",function(a){okDate.key(a,this)})):window.attachEvent&&(c[d].attachEvent("onblur",function(a){a=a||window.event;okDate.blur(a,a.target||a.srcElement)}),c[d].attachEvent("onkeyup",function(a){a=a||window.event;okDate.key(a,a.target||a.srcElement)})))};
okDate.blur=function(c,d,a){"undefined"===typeof a&&(a=d.className.match(/js-ok-date-mdy/)?"mdy":d.className.match(/js-ok-date-dmy/)?"dmy":"ymd");d.className=d.className.replace(okDate.errorClass,"");c=okDate(d.value,a);""!=d.value&&!1===c?(d.title=okDate.errors[okDate.errno],d.className+=" "+okDate.errorClass):(d.title="",d.value=okDate.format(c,a))};
okDate.key=function(c,d,a){"undefined"===typeof a&&(a=d.className.match(/js-ok-date-mdy/)?"mdy":d.className.match(/js-ok-date-dmy/)?"dmy":"ymd");var b;switch(c.keyCode?c.keyCode:c.which){case 38:b=okDate(d.value||"today",a);if(!1===b)break;c.shiftKey?b.setMonth(b.getMonth()+1):b.setDate(b.getDate()+1);d.value=okDate.format(b,a);d.className=d.className.replace(okDate.errorClass,"");break;case 40:b=okDate(d.value||"today",a);if(!1===b)break;c.shiftKey?b.setMonth(b.getMonth()-1):b.setDate(b.getDate()-
1);d.value=okDate.format(b,a);d.className=d.className.replace(okDate.errorClass,"");break;case 39:""==d.value&&(d.value=okDate.format(new Date,a))}return!0};okDate.format=function(c,d){var a=String(c.getFullYear()),b=String(c.getMonth()+1),e=String(c.getDate()),b=1===b.length?"0"+b:b,e=1===e.length?"0"+e:e;return"mdy"==d?b+"/"+e+"/"+a:"dmy"==d?e+"/"+b+"/"+a:a+"-"+b+"-"+e};window.addEventListener?window.addEventListener("load",okDate.init,!1):window.attachEvent&&window.attachEvent("onload",okDate.init);
