/* Copyright (c) 2013 Tyler Uebele * Released under the MIT license. * latest at https://github.com/tyleruebele/jOkay * minified at jscompress.com */
function okDate(e,t){e=e.replace(/^\s+|\s+$/g,"");t="undefined"!==typeof t?t:"mdy";okDate.errno=0;var n=new Date;if(/^now/i.exec(e)){return n}if(/^tod(ay?)?$/i.exec(e)){return n}if((new RegExp("^"+e,"i")).test("tomorrow")){n.setDate(n.getDate()+1);return n}if((new RegExp("^"+e,"i")).test("yesterday")){n.setDate(n.getDate()-1);return n}var r;var i;if(r=/^(\d{1,2})(?:st|nd|rd|th)?$/i.exec(e)){i=n.getMonth();n.setDate(parseInt(r[1],10));if(i!=n.getMonth()){okDate.errno=1;return false}return n}if(r=/^(\d{1,2})(?:st|nd|rd|th)? (\w+)$/i.exec(e)){n.setDate(1);n.setMonth(i=okDate.month(r[2]));n.setDate(parseInt(r[1],10));if(false===i){okDate.errno=3;return false}if(i!=n.getMonth()){okDate.errno=2;return false}return n}if(r=/^(\d{1,2})(?:st|nd|rd|th)? (\w+),? (\d{2,4})$/i.exec(e)){n.setDate(1);n.setFullYear(okDate.year(parseInt(r[3],10)));n.setMonth(i=okDate.month(r[2]));n.setDate(parseInt(r[1],10));if(false===i){okDate.errno=3;return false}if(i!=n.getMonth()){okDate.errno=2;return false}return n}if(r=/^(\w+) (\d{1,2})(?:st|nd|rd|th)?$/i.exec(e)){n.setDate(1);n.setMonth(i=okDate.month(r[1]));n.setDate(parseInt(r[2],10));if(false===i){okDate.errno=3;return false}if(i!=n.getMonth()){okDate.errno=2;return false}return n}if(r=/^(\w+) (\d{1,2})(?:st|nd|rd|th)?,? (\d{2,4})$/i.exec(e)){n.setDate(1);n.setFullYear(okDate.year(parseInt(r[3],10)));n.setMonth(i=okDate.month(r[1]));n.setDate(parseInt(r[2],10));if(false===i){okDate.errno=3;return false}if(i!=n.getMonth()){okDate.errno=2;return false}return n}var s;var o;var u;if(r=/^(\w+)$/i.exec(e)){s=n.getDay();o=okDate.weekday(r[1]);if(false===o){okDate.errno=4;return false}u=o-s;n.setDate(n.getDate()+u);return n}if(r=/^(\w+) week$/i.exec(e)){s=n.getDay();o=okDate.weekday(r[1]);if(false===o){okDate.errno=4;return false}u=o-s;if(o<=s){u+=7}u+=7;n.setDate(n.getDate()+u);return n}if(r=/^next? (\w+)$/i.exec(e)){s=n.getDay();o=okDate.weekday(r[1]);if(false===o){okDate.errno=4;return false}u=o-s;if(o<=s){u+=7}n.setDate(n.getDate()+u);return n}if(r=/^last? (\w+)$/i.exec(e)){s=n.getDay();o=okDate.weekday(r[1]);if(false===o){okDate.errno=4;return false}u=o-s;if(o>=s){u-=7}n.setDate(n.getDate()+u);return n}if(r=/^(\d{1,2})[\/.-](\d{1,2})(?:[\/.-](\d{2,4}))?$/.exec(e)){if("dmy"!=t){var a=r[1];r[1]=r[2];r[2]=a}n.setDate(1);if(r[3]){n.setFullYear(okDate.year(parseInt(r[3],10)))}n.setMonth(i=parseInt(r[2],10)-1);n.setDate(parseInt(r[1],10));if(i>=12){okDate.errno=3;return false}if(i!=n.getMonth()){okDate.errno=2;return false}return n}if(r=/^(\d{4})-(\d{1,2})-(\d{1,2})$/.exec(e)){n.setDate(1);n.setFullYear(parseInt(r[1],10));n.setMonth(i=parseInt(r[2],10)-1);n.setDate(parseInt(r[3],10));if(i>=12){okDate.errno=3;return false}if(i!=n.getMonth()){okDate.errno=2;return false}return n}var f;if(f=Date.parse(e)){n.setTime(f);return n}okDate.errno=okDate.errors.length-1;return false}okDate.year=function(e){return e<70?e+2e3:e<100?e+1900:e<1e3?e+1e3:e};okDate.months=["January","February","March","April","May","June","July","August","September","October","November","December"];okDate.month=function(e){var t=okDate.months.filter(function(t){return(new RegExp("^"+e,"i")).test(t)});if(t.length!=1){return false}return okDate.months.indexOf(t[0])};okDate.weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];okDate.weekday=function(e){var t=okDate.weekdays.filter(function(t){return(new RegExp("^"+e,"i")).test(t)});if(t.length!=1){return false}return okDate.weekdays.indexOf(t[0])};okDate.errno=0;okDate.errors=["Date Validation Passed","Too many days for current month","Too many days for specified month","Invalid month specified","Invalid weekday specified","Date Validation Failed"];okDate.query="input[type=date],"+"input.js-ok-date,"+"input.js-ok-date-ymd,"+"input.js-ok-date-mdy,"+"input.js-ok-date-dmy";okDate.errorClass="js-ok-date-error";okDate.init=function(){var e=document.querySelectorAll(okDate.query);for(var t=e.length-1;t>=0;t--){e[t].addEventListener("blur",function(e){e.preventDefault();okDate.blur(e,this)});if("text"==e[t].type){e[t].addEventListener("keyup",function(e){e.preventDefault();okDate.key(e,this)})}}};okDate.blur=function(e,t,n){if("undefined"===typeof n){n=t.className.match(/js-ok-date-mdy/)?"mdy":t.className.match(/js-ok-date-dmy/)?"dmy":"ymd"}t.className=t.className.replace(okDate.errorClass,"");var r=okDate(t.value,n);if(""!=t.value&&false===r){t.title=okDate.errors[okDate.errno];t.className+=" "+okDate.errorClass}else{t.title="";t.value=okDate.format(r,n)}};okDate.key=function(e,t,n){if("undefined"===typeof n){n=t.className.match(/js-ok-date-mdy/)?"mdy":t.className.match(/js-ok-date-dmy/)?"dmy":"ymd"}var r=e.keyCode?e.keyCode:e.which;var i;switch(r){case 38:i=okDate(t.value||"today",n);i.setDate(i.getDate()+1);t.value=okDate.format(i,n);break;case 40:i=okDate(t.value||"today",n);i.setDate(i.getDate()-1);t.value=okDate.format(i,n);break;case 39:if(t.value!=""){break}i=okDate("today",n);t.value=okDate.format(i,n);break}return true};okDate.format=function(e,t){var n=String(e.getFullYear());var r=String(e.getMonth()+1);var i=String(e.getDate());r=1===r.length?"0"+r:r;i=1===i.length?"0"+i:i;if("mdy"==t){return r+"/"+i+"/"+n}if("dmy"==t){return i+"/"+r+"/"+n}return n+"-"+r+"-"+i};window.addEventListener?window.addEventListener("load",okDate.init,false):window.attachEvent&&window.attachEvent("onload",okDate.init)
